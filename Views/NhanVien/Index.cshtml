@{
    ViewData["Title"] = "Trang chủ Nhân viên";
    Layout = "~/Views/Shared/_LayoutNV.cshtml";
}

<style>
    /* CSS CŨ ĐÃ BỊ LOẠI BỎ */

    /* CSS MỚI CHO HIỆU ỨNG CARD VIỀN MÀU */
    .card-task-box {
        border-radius: 0.25rem;
        box-shadow: 0 0 1px rgba(0, 0, 0, 0.125), 0 1px 3px rgba(0, 0, 0, 0.2);
        margin-bottom: 1rem;
        transition: transform 0.3s ease;
        background-color: #fff; /* Nền trắng */
    }

    .card-task-box:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    /* Viền màu bên trái */
    .border-left-info { border-left: 5px solid #17a2b8 !important; }
    .border-left-warning { border-left: 5px solid #ffc107 !important; }
    .border-left-primary { border-left: 5px solid #007bff !important; }
    .border-left-success { border-left: 5px solid #28a745 !important; }

    .card-task-box .card-body {
        padding: 1.25rem;
        min-height: 120px; /* Điều chỉnh chiều cao cho card */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .card-task-box h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .card-task-box p {
        margin-bottom: 0;
        font-size: 0.9rem;
        color: #6c757d;
    }

    .card-task-box .footer-link {
        display: block;
        margin-top: 10px;
        font-size: 0.85rem;
        font-weight: 500;
        text-align: right;
    }
</style>

<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark">Tổng quan kho hàng</h1>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">

        <div class="row">

            <div class="col-md-6">
                <div class="row">
                    <div class="col-lg-6 col-6">
                        <div class="card-task-box border-left-info">
                            <div class="card-body">
                                <div class="text-left">
                                    <h3>Nhập kho <i class="fas fa-file-import text-info float-right"></i></h3>
                                    <p>Tạo phiếu nhập</p>
                                </div>
                                <a href="@Url.Action("index","NhapHang")" class="text-info footer-link">
                                    Đi tới <i class="fas fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6 col-6">
                        <div class="card-task-box border-left-warning">
                            <div class="card-body">
                                <div class="text-left">
                                    <h3>Xuất kho <i class="fas fa-file-export text-warning float-right"></i></h3>
                                    <p>Tạo phiếu xuất</p>
                                </div>
                                <a href="@Url.Action("index","XuatHang")" class="text-warning footer-link">
                                    Đi tới <i class="fas fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6 col-6">
                        <div class="card-task-box border-left-primary">
                            <div class="card-body">
                                <div class="text-left">
                                    <h3>Chuyển kho <i class="fas fa-dolly text-primary float-right"></i></h3>
                                    <p>Luân chuyển hàng</p>
                                </div>
                                <a href="@Url.Action("Index","KhoHang")" class="text-primary footer-link">
                                    Đi tới <i class="fas fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6 col-6">
                        <div class="card-task-box border-left-success">
                            <div class="card-body">
                                <div class="text-left">
                                    <h3>Kiểm kho <i class="fas fa-clipboard-check text-success float-right"></i></h3>
                                    <p>Thực hiện kiểm kê</p>
                                </div>
                                <a href="@Url.Action("Index","KiemKho")" class="text-success footer-link">
                                    Đi tới <i class="fas fa-arrow-circle-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card card-danger card-outline h-100">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-pie mr-1"></i> Tỉ lệ sai lệch (Đợt kiểm gần nhất)</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                        <canvas id="donutChart" style="min-height: 260px; height: 260px; max-height: 260px; max-width: 100%;"></canvas>
                    </div>
                    <div class="card-footer p-0">
                        <ul class="nav nav-pills flex-column">
                            <li class="nav-item"><a href="#" class="nav-link py-2">Hàng hóa khớp <span class="float-right text-success font-weight-bold">125 mã</span></a></li>
                            <li class="nav-item"><a href="#" class="nav-link py-2">Lệch thừa <span class="float-right text-warning font-weight-bold">10 mã</span></a></li>
                            <li class="nav-item"><a href="#" class="nav-link py-2">Lệch thiếu (Mất hàng) <span class="float-right text-danger font-weight-bold">5 mã</span></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-12">
                <div class="card card-outline card-secondary">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-history mr-1"></i>
                            Lịch sử Phiếu Nhập / Xuất gần đây
                        </h3>
                    </div>
                    <div class="card-body">
                        <table id="historyTable" class="table table-bordered table-striped table-hover">
                            <thead>
                            <tr>
                                <th>Mã phiếu</th>
                                <th>Loại phiếu</th>
                                <th>Ngày tạo</th>
                                <th>Tổng tiền</th>
                                <th>Trạng thái</th>
                                <th>Chi tiết</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td><a href="#" class="text-dark font-weight-bold">PN-20251119-01</a></td>
                                <td><span class="badge bg-info"><i class="fas fa-arrow-down"></i> Nhập kho</span></td>
                                <td>19/11/2025 08:30</td>
                                <td class="text-success font-weight-bold">15,000,000 ₫</td>
                                <td><span class="badge badge-success">Hoàn thành</span></td>
                                <td><button class="btn btn-xs btn-outline-secondary"><i class="fas fa-eye"></i></button></td>
                            </tr>
                            <tr>
                                <td><a href="#" class="text-dark font-weight-bold">PX-20251119-05</a></td>
                                <td><span class="badge bg-warning text-dark"><i class="fas fa-arrow-up"></i> Xuất kho</span></td>
                                <td>19/11/2025 09:15</td>
                                <td class="text-danger font-weight-bold">- 2,500,000 ₫</td>
                                <td><span class="badge badge-warning">Đang xử lý</span></td>
                                <td><button class="btn btn-xs btn-outline-secondary"><i class="fas fa-eye"></i></button></td>
                            </tr>
                            <tr>
                                <td><a href="#" class="text-dark font-weight-bold">CK-20251118-01</a></td>
                                <td><span class="badge bg-primary"><i class="fas fa-exchange-alt"></i> Chuyển kho</span></td>
                                <td>18/11/2025 16:45</td>
                                <td class="text-muted">---</td>
                                <td><span class="badge badge-success">Hoàn thành</span></td>
                                <td><button class="btn btn-xs btn-outline-secondary"><i class="fas fa-eye"></i></button></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <script>
        $(function () {
            // 1. CẤU HÌNH DATATABLE VỚI CÁC NÚT CHỨC NĂNG (Excel, PDF...)
            $("#historyTable").DataTable({
                "responsive": true,
                "lengthChange": false,
                "autoWidth": false,
                "searching": true,
                "ordering": true,
                "info": true,
                "paging": true,
                "dom": 'Bfrtip',
                "buttons": [
                    {
                        extend: 'copy',
                        text: '<i class="fas fa-copy"></i> Sao chép',
                        className: 'btn btn-success btn-sm'
                    },
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'btn btn-success btn-sm'
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'btn btn-success btn-sm'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> In ấn',
                        className: 'btn btn-success btn-sm'
                    },
                    {
                        extend: 'colvis',
                        text: '<i class="fas fa-columns"></i> Cột hiển thị',
                        className: 'btn btn-success btn-sm'
                    }
                ],
                "language": {
                    "search": "Tìm kiếm:",
                    "paginate": { "next": "Sau", "previous": "Trước" },
                    "info": "Hiển thị START đến END trong TOTAL dòng",
                    "emptyTable": "Không có dữ liệu"
                }
            }).buttons().container().appendTo('#historyTable_wrapper .col-md-6:eq(0)');


            // 2. CẤU HÌNH BIỂU ĐỒ (CHART JS) - SỬ DỤNG DỮ LIỆU CỨNG
            var dataKhop = 125; // Số liệu cứng
            var dataThua = 10;  // Số liệu cứng
            var dataThieu = 5;  // Số liệu cứng

            var donutChartCanvas = $('#donutChart').get(0).getContext('2d');
            var donutData = {
                labels: ['Hàng khớp', 'Lệch thừa', 'Lệch thiếu'],
                datasets: [{
                    data: [dataKhop, dataThua, dataThieu],
                    backgroundColor : ['#28a745', '#ffc107', '#dc3545'],
                }]
            }
            var donutOptions = {
                maintainAspectRatio : false,
                responsive : true,
                plugins: {
                    legend: { position: 'left', labels: { boxWidth: 15 } }
                }
            }
            new Chart(donutChartCanvas, { type: 'doughnut', data: donutData, options: donutOptions });
        });
    </script>
}