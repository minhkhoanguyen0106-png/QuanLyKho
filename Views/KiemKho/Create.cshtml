@{
    ViewBag.Title = "Th√™m phi·∫øu ki·ªÉm kho";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid p-3">
    <!-- Header -->
    <div class="d-flex align-items-center mb-3">
        <a href="@Url.Action("Index", "KiemKho")" class="text-dark me-2">
            <i class="bi bi-arrow-left"></i>
        </a>
        <h5 class="fw-bold mb-0 me-3">Ki·ªÉm kho</h5>

        <div class="input-group w-50">
            <span class="input-group-text bg-light border-end-0">
                <i class="bi bi-search"></i>
            </span>
            <input type="text" class="form-control border-start-0" placeholder="T√¨m h√†ng h√≥a theo m√£ ho·∫∑c t√™n (F3)">
            <button id="btnOpenAddProduct" class="btn btn-outline-primary">
                <i class="bi bi-plus"></i>
            </button>
        </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item"><a class="nav-link active" href="#">T·∫•t c·∫£ (0)</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Kh·ªõp (0)</a></li>
        <li class="nav-item"><a class="nav-link" href="#">L·ªách (0)</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Ch∆∞a ki·ªÉm (0)</a></li>
    </ul>

    <div class="row">
        <!-- B·∫£ng s·∫£n ph·∫©m -->
        <div class="col-md-8">
            <div class="bg-white border rounded p-3 shadow-sm">
                <table class="table table-hover align-middle mb-0" id="productTable">
                    <thead class="table-light">
                        <tr>
                            <th>STT</th>
                            <th>M√£ h√†ng</th>
                            <th>T√™n h√†ng</th>
                            <th>ƒêVT</th>
                            <th>T·ªìn kho</th>
                            <th>Th·ª±c t·∫ø</th>
                            <th>SL l·ªách</th>
                            <th>Gi√° tr·ªã l·ªách</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        <tr>
                            <td colspan="8" class="text-center py-5 text-muted">
                                <div>
                                    <p class="fw-semibold mb-1">Th√™m s·∫£n ph·∫©m t·ª´ file excel</p>
                                    <p class="small text-secondary mb-3">
                                        (T·∫£i v·ªÅ file m·∫´u:
                                        <a href="#" class="text-primary text-decoration-none">Excel file</a>)
                                    </p>
                                    <form id="uploadForm" enctype="multipart/form-data" method="post">
    <input type="file" id="fileInput" name="file" class="d-none" accept=".xlsx,.xls" />
    <button type="button" class="btn btn-primary" id="btnSelectFile">
        <i class="bi bi-upload"></i> Ch·ªçn file d·ªØ li·ªáu
    </button>
</form>

<script>
    document.getElementById("btnSelectFile").addEventListener("click", function () {
        document.getElementById("fileInput").click();
    });

    // Khi ng∆∞·ªùi d√πng ch·ªçn file
    document.getElementById("fileInput").addEventListener("change", function () {
        if (this.files.length > 0) {
            const fileName = this.files[0].name;
            alert("ƒê√£ ch·ªçn file: " + fileName);
            // B·∫°n c√≥ th·ªÉ g·ªçi Ajax ho·∫∑c submit form ·ªü ƒë√¢y n·∫øu mu·ªën upload file
            // document.getElementById("uploadForm").submit();
        }
    });
</script>

                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Th√¥ng tin b√™n ph·∫£i -->
        <div class="col-md-4">
            <div class="bg-white border rounded p-3 shadow-sm mb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span><i class="bi bi-person-circle me-2"></i><strong>QU·ªêC TR√ç</strong></span>
                    <span class="text-secondary">@DateTime.Now.ToString("dd/MM/yyyy HH:mm")</span>
                </div>

                <div class="mb-2">
                    <label class="form-label fw-semibold">M√£ ki·ªÉm kho</label>
                    <input type="text" class="form-control" value="M√£ phi·∫øu t·ª± ƒë·ªông" readonly />
                </div>

                <div class="mb-2">
                    <label class="form-label fw-semibold">Tr·∫°ng th√°i</label>
                    <input type="text" class="form-control" value="Phi·∫øu t·∫°m" readonly />
                </div>

                <div class="mb-2">
                    <label class="form-label fw-semibold">T·ªïng SL th·ª±c t·∫ø</label>
                    <input type="text" class="form-control" value="0" readonly />
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Ghi ch√∫</label>
                    <textarea class="form-control" rows="2" placeholder="Ghi ch√∫"></textarea>
                </div>

                <div class="bg-light p-2 rounded">
                    <h6 class="fw-bold mb-2">Ki·ªÉm g·∫ßn ƒë√¢y</h6>
                    <p class="text-secondary mb-0 small">(Ch∆∞a c√≥ d·ªØ li·ªáu)</p>
                </div>
            </div>

            <!-- N√∫t h√†nh ƒë·ªông -->
            <div class="d-flex justify-content-between">
                <button class="btn btn-primary w-50 me-2">
                    <i class="bi bi-save"></i> L∆∞u t·∫°m
                </button>
                <button class="btn btn-success w-50">
                    <i class="bi bi-check2-circle"></i> Ho√†n th√†nh
                </button>
            </div>
        </div>
    </div>
</div>

<!-- üîπ Modal th√™m s·∫£n ph·∫©m -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addProductModalLabel">Th√™m s·∫£n ph·∫©m v√†o ki·ªÉm kho</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">M√£ h√†ng</label>
                    <input type="text" class="form-control" id="productCode">
                </div>
                <div class="mb-3">
                    <label class="form-label">T√™n h√†ng</label>
                    <input type="text" class="form-control" id="productName">
                </div>
                <div class="mb-3">
                    <label class="form-label">ƒê∆°n v·ªã t√≠nh</label>
                    <input type="text" class="form-control" id="productUnit" placeholder="VD: C√°i, chi·∫øc...">
                </div>
                <div class="mb-3">
                    <label class="form-label">T·ªìn kho</label>
                    <input type="number" class="form-control" id="stockQty">
                </div>
                <div class="mb-3">
                    <label class="form-label">Th·ª±c t·∫ø</label>
                    <input type="number" class="form-control" id="realQty">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                <button type="button" class="btn btn-success" id="btnSaveProduct">L∆∞u</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
document.addEventListener("DOMContentLoaded", function () {
    const addBtn = document.getElementById("btnOpenAddProduct");
    const modal = new bootstrap.Modal(document.getElementById("addProductModal"));
    const saveBtn = document.getElementById("btnSaveProduct");
    const tableBody = document.getElementById("productTableBody");

    addBtn.addEventListener("click", function () {
        modal.show();
    });

    saveBtn.addEventListener("click", function () {
        const code = document.getElementById("productCode").value.trim();
        const name = document.getElementById("productName").value.trim();
        const unit = document.getElementById("productUnit").value.trim();
        const stock = document.getElementById("stockQty").value;
        const real = document.getElementById("realQty").value;

        if (!code || !name) {
            alert("Vui l√≤ng nh·∫≠p m√£ h√†ng v√† t√™n h√†ng!");
            return;
        }

        const diff = real - stock;
        const newRow = `
            <tr>
                <td>${tableBody.rows.length + 1}</td>
                <td>${code}</td>
                <td>${name}</td>
                <td>${unit || '-'}</td>
                <td>${stock || 0}</td>
                <td>${real || 0}</td>
                <td class="${diff == 0 ? 'text-success' : 'text-danger'}">${diff}</td>
                <td>-</td>
            </tr>`;

        tableBody.insertAdjacentHTML("beforeend", newRow);
        modal.hide();

        document.getElementById("productCode").value = "";
        document.getElementById("productName").value = "";
        document.getElementById("productUnit").value = "";
        document.getElementById("stockQty").value = "";
        document.getElementById("realQty").value = "";
    });
});
</script>
}