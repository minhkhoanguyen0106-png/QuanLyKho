﻿@using Microsoft.AspNetCore.Http
@{
    ViewData["Title"] = "Tổng quan";
    var primaryGreen = "#428446";
}

<div class="content-header">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center p-3 rounded shadow-sm"
             style="background-color: @primaryGreen; color: white;">
            <h4 class="m-0 font-weight-bold"><i class="fas fa-chart-line mr-2"></i> Tổng quan hoạt động</h4>
            <span>Chi nhánh: <strong>Admin</strong></span>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row mt-3">
            <div class="col-lg-3 col-6">
                <div class="small-box bg-white border-left border-success shadow-sm" style="border-left-width: 5px !important;">
                    <div class="inner">
                        <h3 style="color: @primaryGreen">186,7 Tr</h3>
                        <p>Doanh thu thuần</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-dollar-sign text-success" style="opacity: 0.3"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box bg-white border-left border-success shadow-sm" style="border-left-width: 5px !important;">
                    <div class="inner">
                        <h3 class="text-success">42,2 Tr</h3>
                        <p>Doanh thu (8 đơn)</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-shopping-cart text-success" style="opacity: 0.3"></i>
                    </div>
                </div>
            </div>
             <div class="col-lg-3 col-6">
                <div class="small-box bg-white border-left border-danger shadow-sm" style="border-left-width: 5px !important;">
                    <div class="inner">
                        <h3 class="text-danger">0 ₫</h3>
                        <p>Trả hàng</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-undo text-danger" style="opacity: 0.3"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box bg-white border-left border-warning shadow-sm" style="border-left-width: 5px !important;">
                    <div class="inner">
                        <h3 class="text-warning">403</h3>
                        <p>Hàng hết hạn</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-exclamation-triangle text-warning" style="opacity: 0.3"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-9">
                <div class="card card-success card-outline">
                    <div class="card-header">
                        <h3 class="card-title">Doanh thu thuần theo ngày</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <canvas id="chartDoanhThu" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header bg-light">
                        <h3 class="card-title text-success font-weight-bold">Hoạt động gần đây</h3>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <span class="text-success font-weight-bold">HUỲNH GIANG</span> vừa bán<br>
                                <b>12,060,000 ₫</b> <small class="text-muted float-right">4h trước</small>
                            </li>
                            <li class="list-group-item">
                                <span class="text-success font-weight-bold">DI PHÚC</span> vừa bán<br>
                                <b>15,090,000 ₫</b> <small class="text-muted float-right">6h trước</small>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card card-outline card-primary">
                    <div class="card-header">
                        <h3 class="card-title">Top 10 Hàng hóa bán chạy</h3>
                    </div>
                    <div class="card-body">
                        <table id="topProductsTable" class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Mã hàng</th>
                                    <th>Tên hàng hóa</th>
                                    <th>ĐVT</th>
                                    <th>Số lượng</th>
                                    <th>Doanh thu</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>SP001</td><td>Bình Super Chillwee</td><td>Cái</td><td class="text-success font-weight-bold">464</td><td>250,000,000 ₫</td></tr>
                                <tr><td>DV002</td><td>Tiền công sửa chữa</td><td>Lần</td><td class="text-success font-weight-bold">98</td><td>9,800,000 ₫</td></tr>
                                <tr><td>VC003</td><td>VOUCHER - 500K</td><td>Phiếu</td><td class="text-success font-weight-bold">84</td><td>0 ₫</td></tr>
                                <tr><td>MBH01</td><td>NÓN BẢO HIỂM EBIKE</td><td>Cái</td><td class="text-success font-weight-bold">23</td><td>2,300,000 ₫</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    <script>
        $(document).ready(function () {
            // 1. Khởi tạo DataTable với nút Export
           $("#topProductsTable").DataTable({
    "responsive": true,
    "lengthChange": false,
    "autoWidth": false,
    "dom": 'Bfrtip',
    "buttons": [
        { 
            extend: 'copy', 
            text: '<i class="fas fa-copy"></i> Sao chép', 
            className: 'btn btn-success' 
        },
        { 
            extend: 'excel', 
            text: '<i class="fas fa-file-excel"></i> Excel', 
            className: 'btn btn-success' 
        },
        { 
            extend: 'pdf', 
            text: '<i class="fas fa-file-pdf"></i> PDF', 
            className: 'btn btn-success' 
        },
        { 
            extend: 'print', 
            text: '<i class="fas fa-print"></i> In ấn', 
            className: 'btn btn-success' 
        },
        {
            extend: 'colvis',
            text: 'Hiển thị cột',
            className: 'btn btn-success' 
        }
    ],
    "language": { 
        "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/vi.json" 
    }
}).buttons().container().appendTo('#topProductsTable_wrapper .col-md-6:eq(0)');

            // 2. Vẽ biểu đồ Chart.js
            var ctx = document.getElementById('chartDoanhThu').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 31}, (_, i) => i + 1),
                    datasets: [
                        { label: 'Ebike Nguyễn Văn Cừ', data: [12, 19, 3, 5, 2, 3, 10, 15, 8, 12, 19, 3, 5, 2, 3, 10, 15, 8, 12, 19, 3, 5, 2, 3, 10, 15, 8, 12, 19, 3, 5, 2], backgroundColor: '#428446' },
                        { label: 'Ebike 3 Tháng 2', data: [2, 3, 20, 5, 1, 4, 8, 5, 2, 3, 20, 5, 1, 4, 8, 5, 2, 3, 20, 5, 1, 4, 8, 5, 2, 3, 20, 5, 1, 4, 8, 5], backgroundColor: '#ffc107' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true }
                    }
                }
            });
        });
    </script>
}